name: ğŸ­ Factory Bulk Generator & Deploy

on:
  workflow_dispatch: # ë²„íŠ¼ í´ë¦­ìš©

permissions:
  contents: write
  pages: write      # [ì¶”ê°€] ë°°í¬ ê¶Œí•œ
  id-token: write   # [ì¶”ê°€] ë°°í¬ ê¶Œí•œ

jobs:
  bulk-generate-and-deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    runs-on: ubuntu-latest
    
    steps:
      - name: 1. ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
        uses: actions/checkout@v4

      - name: 2. ìµœì‹  ì½”ë“œ ë™ê¸°í™”
        run: |
          git config --global user.name "Benjamin5607"
          git config --global user.email "Benjamin5607@users.noreply.github.com"
          git pull origin main --rebase || echo "Up to date"

      - name: 3. íŒŒì´ì¬ ì„¤ì¹˜
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: 4. ë„êµ¬ ì„¤ì¹˜
        run: pip install requests

      - name: 5. ë°ì´í„° ê³µì¥ ê°€ë™ (50ê°œ ìƒì‚°)
        env: 
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        run: python seed.py

      - name: 6. ë°ì´í„° ì €ì¥ ë° ì—…ë¡œë“œ
        run: |
          git add data.json
          git commit -m "ğŸ­ Bulk Data Injection & Deploy" || echo "No changes"
          git push https://${{ secrets.GH_PAT }}@github.com/${{ github.repository }}.git HEAD:main

      # --- [ì¶”ê°€ëœ ë°°í¬ ì½”ë“œ] ì—¬ê¸°ì„œë¶€í„° ì›¹ì‚¬ì´íŠ¸ë¡œ ì´ì¤ë‹ˆë‹¤ ---

      - name: 7. ì›¹ì‚¬ì´íŠ¸ íŒŒì¼ ë¬¶ê¸°
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'

      - name: 8. GitHub Pagesì— ë°°í¬í•˜ê¸°
        id: deployment
        uses: actions/deploy-pages@v4
