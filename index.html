<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Culture Risk Database</title>
    <style>
        /* [ìŠ¤íƒ€ì¼] */
        body { background-color: #121212; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        
        /* í—¤ë” & ê²€ìƒ‰ì°½ */
        header { display: flex; flex-direction: column; gap: 15px; border-bottom: 1px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        h1 { margin: 0; font-size: 24px; color: #fff; }
        .last-update { font-size: 12px; color: #666; margin-top: 5px; }

        /* [ê²€ìƒ‰ì°½ ë””ìì¸] */
        .search-box-wrapper { position: relative; width: 100%; max-width: 600px; margin: 0 auto; }
        .search-input { 
            width: 100%; padding: 15px 20px; font-size: 16px; 
            background: #1e1e1e; border: 2px solid #333; color: #fff; 
            border-radius: 30px; outline: none; transition: 0.3s;
        }
        .search-input:focus { border-color: #3b82f6; box-shadow: 0 0 15px rgba(59, 130, 246, 0.3); }
        .search-btn {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            background: #3b82f6; color: white; border: none; padding: 8px 20px;
            border-radius: 20px; cursor: pointer; font-weight: bold;
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; align-items: center; justify-content: space-between; }
        .tabs { display: flex; gap: 5px; }
        .tab-btn { background-color: #2c2c2c; color: #aaa; border: 1px solid #444; padding: 8px 16px; cursor: pointer; border-radius: 6px; font-weight: bold; transition: 0.2s; }
        .tab-btn:hover { background-color: #333; color: #fff; }
        .tab-btn.active { background-color: #3b82f6; color: white; border-color: #3b82f6; }

        /* í…Œì´ë¸” */
        .table-wrapper { background: #1e1e1e; border-radius: 12px; overflow-x: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.4); min-height: 300px; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background-color: #252525; color: #aaa; text-align: left; padding: 15px; border-bottom: 2px solid #333; font-size: 13px; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #2c2c2c; font-size: 14px; vertical-align: top; }

        /* ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        .term-text { font-weight: bold; font-size: 1.2em; color: #fff; display: block; }
        .slang-term { font-size: 1.4em; font-weight: bold; color: #3b82f6; display: block; margin-bottom: 5px; }
        .live-badge { background: #e11d48; color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; vertical-align: middle; margin-left: 5px; animation: pulse 2s infinite; }
        
        .cat-badge { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 11px; background: #333; color: #ccc; border: 1px solid #444; margin-right: 4px; }
        .col-context { color: #ccc; line-height: 1.6; font-size: 1em; }
        
        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loading-spinner { text-align: center; padding: 50px; color: #666; font-size: 1.2em; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div>
                    <h1>Global Culture Risk Database</h1>
                    <div id="last-updated" class="last-update">Database Loading...</div>
                </div>
            </div>
            
            <div class="search-box-wrapper">
                <input type="text" id="searchInput" class="search-input" placeholder="Search slang, people, or groups..." onkeypress="handleEnter(event)">
                <button class="search-btn" onclick="performSearch()">Search</button>
            </div>
        </header>

        <div class="controls">
            <div class="tabs">
                <button class="tab-btn active" onclick="filterGroup('all')">ALL</button>
                <button class="tab-btn" onclick="filterGroup('language')">ğŸ’¬ Slang</button>
                <button class="tab-btn" onclick="filterGroup('person')">ğŸ‘¤ People</button>
                <button class="tab-btn" onclick="filterGroup('group')">âš ï¸ Groups</button>
            </div>
        </div>

        <div class="table-wrapper">
            <table>
                <thead id="table-head">
                    <tr>
                        <th width="20%">Term</th>
                        <th width="15%">Category</th>
                        <th>Definition / Context</th>
                        <th style="text-align:right">Source</th>
                    </tr>
                </thead>
                <tbody id="table-body"></tbody>
            </table>
        </div>
    </div>

    <script>
        let allData = [];
        let currentGroup = 'all';

        async function init() {
            try {
                const res = await fetch('data.json?v=' + Date.now());
                if (!res.ok) throw new Error("File not found");
                allData = await res.json();
                document.getElementById('last-updated').innerText = `DB Status: ${allData.length} items loaded.`;
                renderTable(allData.slice(0, 50)); // ì´ˆê¸°ì—” 50ê°œë§Œ
            } catch (e) {
                console.error(e);
            }
        }

        // --- ê²€ìƒ‰ ë¡œì§ (í•µì‹¬) ---
        function handleEnter(e) {
            if (e.key === 'Enter') performSearch();
        }

        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();
            const tbody = document.getElementById('table-body');

            if (!query) {
                renderTable(allData.slice(0, 50)); // ê²€ìƒ‰ì–´ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
                return;
            }

            // 1. ë¡œì»¬ DBì—ì„œ ë¨¼ì € ì°¾ê¸° (í•„í„°ë§)
            const localResults = allData.filter(item => item.term.toLowerCase().includes(query));
            
            // í™”ë©´ ì¼ë‹¨ í´ë¦¬ì–´í•˜ê³  ë¡œë”© í‘œì‹œ
            tbody.innerHTML = '<tr><td colspan="4" class="loading-spinner">Searching Local DB & Urban Dictionary... ğŸŒ</td></tr>';

            // 2. ë§Œì•½ DBì— ê²°ê³¼ê°€ ìˆìœ¼ë©´ ë¨¼ì € ë³´ì—¬ì¤„ ì¤€ë¹„
            let finalResults = [...localResults];

            // 3. [ì‹¤ì‹œê°„] Urban Dictionary API í˜¸ì¶œ
            try {
                const res = await fetch(`https://api.urbandictionary.com/v0/define?term=${encodeURIComponent(query)}`);
                const data = await res.json();
                
                if (data.list && data.list.length > 0) {
                    // ê°€ì¥ ì¢‹ì•„ìš” ë§ì€ ì •ì˜ ê°€ì ¸ì˜¤ê¸°
                    const best = data.list.sort((a, b) => b.thumbs_up - a.thumbs_up)[0];
                    
                    // ì¤‘ë³µ ì²´í¬ (DBì— ì´ë¯¸ ìˆëŠ” ë‹¨ì–´ë©´ ì¶”ê°€ ì•ˆ í•¨)
                    const exists = finalResults.some(r => r.term.toLowerCase() === best.word.toLowerCase());
                    
                    if (!exists) {
                        // ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ í¬ë§·ì— ë§ì¶° ë³€í™˜
                        const liveItem = {
                            term: best.word,
                            category: 'Live Search',
                            country: ['Global'],
                            context: { en: best.definition.replace(/[\[\]]/g, "") }, // ëŒ€ê´„í˜¸ ì œê±°
                            status: 'Live',
                            isLive: true // ë¼ì´ë¸Œ ë±ƒì§€ìš© í”Œë˜ê·¸
                        };
                        finalResults.unshift(liveItem); // ë§¨ ì•ì— ì¶”ê°€
                    }
                }
            } catch (e) {
                console.error("Urban API Error:", e);
            }

            // 4. ìµœì¢… ê²°ê³¼ ë Œë”ë§
            if (finalResults.length > 0) {
                renderTable(finalResults);
            } else {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:30px;">No results found anywhere. ğŸ¤·â€â™‚ï¸</td></tr>';
            }
        }

        function filterGroup(group) {
            currentGroup = group;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            // ë²„íŠ¼ í™œì„±í™” ë¡œì§
            const btns = document.querySelectorAll('.tab-btn');
            for(let btn of btns) {
                if(btn.innerText.includes(group === 'all' ? 'ALL' : (group === 'language' ? 'Slang' : (group === 'person' ? 'People' : 'Groups')))) {
                    btn.classList.add('active');
                }
            }
            
            const data = group === 'all' ? allData : allData.filter(d => d.group === group);
            renderTable(data.slice(0, 50));
        }

        function renderTable(data) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            data.forEach(item => {
                const context = item.context['ko'] || item.context['en'] || Object.values(item.context)[0];
                const isLive = item.isLive ? '<span class="live-badge">LIVE WEB</span>' : '';
                const source = item.isLive ? 'Urban Dictionary' : 'Local DB';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="vertical-align:top;">
                        <span class="slang-term">${item.term} ${isLive}</span>
                        <span class="cat-badge">${item.country ? item.country[0] : 'Global'}</span>
                    </td>
                    <td style="vertical-align:top;">
                        <span class="cat-badge" style="background:#2a2a2a;">${item.category}</span>
                    </td>
                    <td class="col-context">${context}</td>
                    <td style="text-align:right; color:#666; font-size:12px;">${source}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        init();
    </script>
</body>
</html>
