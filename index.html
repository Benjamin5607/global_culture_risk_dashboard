<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Culture Risk Database</title>
    <style>
        /* ê¸°ë³¸ ì„¤ì • */
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 30px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 24px; color: #fff; letter-spacing: 1px; }
        .last-update { font-size: 12px; color: #666; }

        /* íƒ­ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            background-color: #1e1e1e;
            color: #888;
            border: 1px solid #333;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .tab-btn:hover { background-color: #2a2a2a; color: #fff; }
        
        .tab-btn.active {
            background-color: #3b82f6; /* í™œì„± íƒ­ ìƒ‰ìƒ (íŒŒë‘) */
            color: white;
            border-color: #3b82f6;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-wrapper {
            background: #1e1e1e;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            overflow: hidden; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ìœ ì§€ */
            overflow-x: auto;
        }

        table { width: 100%; border-collapse: collapse; min-width: 1000px; }

        th {
            background-color: #252525;
            color: #aaa;
            text-align: left;
            padding: 15px;
            font-size: 13px;
            text-transform: uppercase;
            border-bottom: 2px solid #333;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #2c2c2c;
            font-size: 14px;
            vertical-align: top;
        }

        tr:hover { background-color: #252525; }

        /* ì»¬ëŸ¼ë³„ ë„ˆë¹„ ì¡°ì • */
        .col-term { width: 15%; font-weight: bold; color: #fff; font-size: 1.05rem; }
        .col-risk { width: 10%; }
        .col-score { width: 10%; }
        .col-info { width: 15%; } /* êµ­ê°€, ì¹´í…Œê³ ë¦¬ */
        .col-context { width: 35%; color: #ccc; line-height: 1.5; font-size: 0.9rem; }
        .col-status { width: 10%; text-align: right; }

        /* ë±ƒì§€ ë””ìì¸ */
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 4px;
            margin-bottom: 4px;
        }

        .bg-country { background: #334155; color: #cbd5e1; border: 1px solid #475569; }
        .bg-category { background: #3f3f46; color: #e4e4e7; border: 1px solid #52525b; }

        /* ë¦¬ìŠ¤í¬ ë ˆë²¨ */
        .risk-high { color: #ff4444; border: 1px solid #ff4444; padding: 2px 6px; border-radius: 4px; font-size: 12px; }
        .risk-medium { color: #ffbb33; border: 1px solid #ffbb33; padding: 2px 6px; border-radius: 4px; font-size: 12px; }
        .risk-low { color: #00C851; border: 1px solid #00C851; padding: 2px 6px; border-radius: 4px; font-size: 12px; }

        /* íŠ¸ë Œë“œ ì ìˆ˜ ë°” */
        .trend-bar-bg { background: #333; height: 4px; width: 100%; margin-top: 8px; border-radius: 2px; }
        .trend-bar-fill { height: 100%; border-radius: 2px; }
        
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .dot-active { background-color: #00C851; }
        .dot-review { background-color: #ffbb33; }
        .dot-archived { background-color: #666; }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Global Culture Risk Monitor</h1>
            <div id="last-updated" class="last-update">Loading...</div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="filterGroup('language')">ğŸ’¬ Language & Slang</button>
            <button class="tab-btn" onclick="filterGroup('person')">ğŸ‘¤ Public Figures</button>
            <button class="tab-btn" onclick="filterGroup('group')">âš ï¸ Dangerous Groups</button>
            <button class="tab-btn" onclick="filterGroup('trend')">ğŸ“± Platform Trends</button>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Term / Name</th>
                        <th>Risk Level</th>
                        <th>Trend Score</th>
                        <th>Info</th>
                        <th>Context & Guide</th>
                        <th style="text-align:right">Status</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <tr><td colspan="6" style="text-align:center; padding:30px;">Loading Database...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let allData = []; // ì „ì²´ ë°ì´í„°ë¥¼ ì €ì¥í•  ë³€ìˆ˜

        async function initDashboard() {
            try {
                // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ìºì‹œ ë°©ì§€)
                const response = await fetch('data.json?v=' + new Date().getTime());
                allData = await response.json();

                // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ (ì²« ë²ˆì§¸ ë°ì´í„° ê¸°ì¤€)
                if(allData.length > 0) {
                    document.getElementById('last-updated').innerText = "System Updated: " + new Date().toLocaleString();
                }

                // ì²˜ìŒì— 'language' íƒ­ ë³´ì—¬ì£¼ê¸°
                filterGroup('language');

            } catch (error) {
                console.error("Error:", error);
                document.getElementById('table-body').innerHTML = `<tr><td colspan="6" style="text-align:center; color:red;">Failed to load data.json</td></tr>`;
            }
        }

        // íƒ­ í´ë¦­ ì‹œ í•„í„°ë§í•˜ëŠ” í•¨ìˆ˜
        function filterGroup(groupName) {
            // 1. íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active'); // í´ë¦­ëœ ë²„íŠ¼ í™œì„±í™” (ì£¼ì˜: ì´ˆê¸° ì‹¤í–‰ì‹œëŠ” ìˆ˜ë™ ì²˜ë¦¬ í•„ìš”í•  ìˆ˜ ìˆìŒ)
            
            // ì´ˆê¸° ë¡œë”© ì‹œì—ëŠ” ë²„íŠ¼ ì´ë²¤íŠ¸ê°€ ì—†ìœ¼ë¯€ë¡œ ì˜ˆì™¸ ì²˜ë¦¬
            if (!event.target.classList.contains('tab-btn')) {
                 document.querySelector(`button[onclick="filterGroup('${groupName}')"]`).classList.add('active');
            }


            // 2. ë°ì´í„° í•„í„°ë§
            const filteredData = allData.filter(item => item.group === groupName);
            renderTable(filteredData);
        }

        // í…Œì´ë¸” ê·¸ë¦¬ëŠ” í•¨ìˆ˜
        function renderTable(data) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:30px; color:#666;">No data found in this category.</td></tr>`;
                return;
            }

            data.forEach(item => {
                const tr = document.createElement('tr');

                // êµ­ê°€ ë±ƒì§€ ìƒì„±
                const countries = item.country.map(c => `<span class="badge bg-country">${c}</span>`).join('');
                
                // ì ìˆ˜ ìƒ‰ìƒ
                let scoreColor = '#00C851';
                if(item.trend_score >= 80) scoreColor = '#ff4444';
                else if(item.trend_score >= 50) scoreColor = '#ffbb33';

                // ìƒíƒœ ì  ìƒ‰ìƒ
                let dotClass = 'dot-active';
                if(item.status === 'Review') dotClass = 'dot-review';
                if(item.status === 'Archived') dotClass = 'dot-archived';

                tr.innerHTML = `
                    <td class="col-term">${item.term}</td>
                    
                    <td class="col-risk">
                        <span class="${item.risk_level === 'High' ? 'risk-high' : (item.risk_level === 'Medium' ? 'risk-medium' : 'risk-low')}">
                            ${item.risk_level}
                        </span>
                    </td>
                    
                    <td class="col-score">
                        <div style="font-weight:bold; font-size:1.1em;">${item.trend_score}</div>
                        <div class="trend-bar-bg">
                            <div class="trend-bar-fill" style="width: ${item.trend_score}%; background-color: ${scoreColor};"></div>
                        </div>
                    </td>

                    <td class="col-info">
                        <div style="margin-bottom:5px;">${countries}</div>
                        <span class="badge bg-category">${item.category}</span>
                    </td>

                    <td class="col-context">
                        ${item.context}
                        <div style="margin-top:8px; font-size:0.8em; color:#666;">
                            Detected: ${item.first_detected}
                        </div>
                    </td>

                    <td class="col-status">
                        <span class="status-dot ${dotClass}"></span>${item.status}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ì‹œì‘
        initDashboard();

    </script>
</body>
</html>
